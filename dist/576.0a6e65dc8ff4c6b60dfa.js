"use strict";(self.webpackChunkmytonwallet=self.webpackChunkmytonwallet||[]).push([[576],{32693:(t,e,n)=>{n.d(e,{Hz:()=>r,PY:()=>i,eZ:()=>a});const a=3,r=125,i=10},87576:(t,e,n)=>{n.d(e,{connectLedger:()=>E,detectAvailableTransports:()=>S,getTransportOrFail:()=>m,hasUsbDevice:()=>g,openSystemBluetoothSettings:()=>D});var a=n(68238),r=n(7416),i=n(31481),o=n(55029),s=n(37836),c=n(82393),w=n(32693);let u,l,d,p,f,h,y,b;async function A(){if(i.UMQ)return f||(f=Promise.all([n.e(580),n.e(513),n.e(642)]).then(n.bind(n,17642)).then(t=>t.BleConnector),h=await f),f}async function v(){if(c.xy){if(!p){p=Promise.all([n.e(580),n.e(897)]).then(n.bind(n,52897)).then(t=>({transport:t.HIDTransport,listLedgerDevices:t.listLedgerDevices}));const t=await p;y=t.transport,b=t.listLedgerDevices}return p}}async function S(){await A(),await v();const[t,e,n]=await Promise.all([c.xy?y.isSupported():a.A.isSupported(),!!h&&h.isSupported(),r.A.isSupported()]);return(0,o.MD)("LEDGER TRANSPORTS",{hid:t,bluetooth:e,webUsb:n}),l={hid:t,bluetooth:e,webUsb:n},{isUsbAvailable:t||n,isBluetoothAvailable:e}}async function g(){const t=await P();return t.hid?c.xy?await L(b):await L(()=>a.A.list(),()=>a.A.create()):!!t.webUsb&&await L(()=>r.A.list(),()=>r.A.create())}function D(){h&&h.openSettings()}async function E(t){const e=await P();t&&(d=t);try{return"bluetooth"===d?u=await async function(){if(!h)throw new Error("BLE is not supported on this device.");return(await h.connect()).bleTransport}():e.hid?u=await(c.xy?async function(){for(let t=0;t<w.PY;t++){const[t]=await b();if(t)try{return await Promise.race([y.open(t),new Promise((t,e)=>{setTimeout(()=>e(new Error),1e3)})])}catch(t){await(0,s.v7)(w.Hz)}else await(0,s.v7)(w.Hz)}throw new Error("Failed to connect")}():async function(){for(let t=0;t<w.PY;t++){const[t]=await a.A.list();if(t)return t.opened?new a.A(t):a.A.open(t);await a.A.create(),await(0,s.v7)(w.Hz)}throw new Error("Failed to connect")}()):e.webUsb&&(u=await async function(){for(let t=0;t<w.PY;t++){const[t]=await r.A.list();if(t)return t.opened?await r.A.openConnected()??await r.A.request():r.A.open(t);await r.A.create(),await(0,s.v7)(w.Hz)}throw new Error("Failed to connect")}()),!!u||((0,o.SJ)("connectLedger: BLE and/or HID are not supported"),!1)}catch(t){return(0,o.SJ)("connectLedger",t),!1}}async function L(t,e){try{for(let n=0;n<w.eZ;n++){const[n]=await t();if(n)return!0;e&&await e(),await(0,s.v7)(w.Hz)}}catch(t){(0,o.SJ)("tryDetectDevice",t)}return!1}async function P(){return l||await S(),l}function m(){if(!u)throw new Error("Ledger transport is not initialized");return u}A(),v()}}]);
//# sourceMappingURL=576.0a6e65dc8ff4c6b60dfa.js.map