"use strict";(self.webpackChunkmytonwallet=self.webpackChunkmytonwallet||[]).push([[557],{5524:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.createBackoff=t.exponentialBackoffDelay=void 0;const i=n(20815);function o(e,t,n,r){let i=t+(n-t)/r*Math.max(e,r);return Math.round(Math.random()*i)}t.exponentialBackoffDelay=o,t.createBackoff=function(e){return t=>r(this,void 0,void 0,function*(){let n=0;const r=e&&void 0!==e.minDelay?e.minDelay:250,s=e&&void 0!==e.maxDelay?e.maxDelay:1e3,a=e&&void 0!==e.maxFailureCount?e.maxFailureCount:50;for(;;)try{return yield t()}catch(t){n<a&&n++,e&&e.onError&&e.onError(t,n);let l=o(n,r,s,a);yield(0,i.delay)(l)}})}},20815:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})};function r(e){return n(this,void 0,void 0,function*(){return new Promise(t=>setTimeout(t,e))})}Object.defineProperty(t,"__esModule",{value:!0}),t.minimumDelay=t.delay=void 0,t.delay=r,t.minimumDelay=function(e,t){return n(this,void 0,void 0,function*(){let n=Date.now(),i=yield t,o=e-(Date.now()-n);return o>0&&(yield r(o)),i})}},30085:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asyncTimeout=void 0,t.asyncTimeout=function(e,t){return new Promise((n,r)=>{let i=null;function o(e){i&&(clearTimeout(i),i=null),r(e)}i=setTimeout(()=>{o(new Error("Request timeout"))},t),e.then(function(e){i&&(clearTimeout(i),i=null),n(e)}),e.catch(o)})}},32853:(e,t,n)=>{var r=n(48287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.writeCellInline=t.writeCellRef=t.writeAddress=t.writeUint8=t.writeVarUInt=t.writeUint64=t.writeUint48=t.writeUint16=t.writeUint32=void 0;const i=n(1307);function o(e){let t=r.alloc(2);return t.writeUint16BE(e,0),t}function s(e){let t=r.alloc(1);return t[0]=e,t}t.writeUint32=function(e){let t=r.alloc(4);return t.writeUint32BE(e,0),t},t.writeUint16=o,t.writeUint48=function(e){let t=r.alloc(6);return t.writeUint16BE(e>>32,0),t.writeUint32BE(0&e,2),t},t.writeUint64=function(e){return(0,i.beginCell)().storeUint(e,64).endCell().beginParse().loadBuffer(8)},t.writeVarUInt=function(e){const t=0n===e?0:Math.ceil(e.toString(2).length/8);return(0,i.beginCell)().storeUint(t,8).storeUint(e,8*t).endCell().beginParse().loadBuffer(1+t)},t.writeUint8=s,t.writeAddress=function(e){return r.concat([s(-1===e.workChain?255:e.workChain),e.hash])},t.writeCellRef=function(e){return r.concat([o(e.depth()),e.hash()])},t.writeCellInline=function(e){return r.concat([s(e.length),e])}},34557:(e,t,n)=>{t._t=t.vY=t.vs=void 0;var r=n(80715);Object.defineProperty(t,"vs",{enumerable:!0,get:function(){return r.TonTransport}}),Object.defineProperty(t,"vY",{enumerable:!0,get:function(){return r.parseMessage}}),Object.defineProperty(t,"_t",{enumerable:!0,get:function(){return r.KNOWN_JETTONS}})},36612:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidateSync=void 0;const i=n(5524);t.InvalidateSync=class{constructor(e,t){this._invalidated=!1,this._invalidatedDouble=!1,this._stopped=!1,this._doSync=()=>r(this,void 0,void 0,function*(){yield this._backoff(()=>r(this,void 0,void 0,function*(){this._stopped||(yield this._command())})),this._stopped||(this._invalidatedDouble?(this._invalidatedDouble=!1,this._doSync()):this._invalidated=!1)}),this._backoff=t&&t.backoff?t.backoff:(0,i.createBackoff)(),this._command=e}invalidate(){this._stopped||(this._invalidated||(this._invalidated=!0,this._invalidatedDouble=!1,this._doSync()),this._invalidatedDouble||(this._invalidatedDouble=!0))}stop(){this._stopped||(this._stopped=!0)}}},38106:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asyncTimeout=t.minimumDelay=t.delay=t.exponentialBackoffDelay=t.createBackoff=t.BoundedConcurrencyPool=t.UnboundedConcurrencyPool=t.Queue=t.SyncValue=t.InvalidateSync=t.AsyncLock=t.createAsyncIterator=void 0;var r=n(74559);Object.defineProperty(t,"createAsyncIterator",{enumerable:!0,get:function(){return r.createAsyncIterator}});var i=n(51931);Object.defineProperty(t,"AsyncLock",{enumerable:!0,get:function(){return i.AsyncLock}});var o=n(36612);Object.defineProperty(t,"InvalidateSync",{enumerable:!0,get:function(){return o.InvalidateSync}});var s=n(69820);Object.defineProperty(t,"SyncValue",{enumerable:!0,get:function(){return s.SyncValue}});var a=n(51483);Object.defineProperty(t,"Queue",{enumerable:!0,get:function(){return a.Queue}});var l=n(78261);Object.defineProperty(t,"UnboundedConcurrencyPool",{enumerable:!0,get:function(){return l.UnboundedConcurrencyPool}}),Object.defineProperty(t,"BoundedConcurrencyPool",{enumerable:!0,get:function(){return l.BoundedConcurrencyPool}});var c=n(5524);Object.defineProperty(t,"createBackoff",{enumerable:!0,get:function(){return c.createBackoff}}),Object.defineProperty(t,"exponentialBackoffDelay",{enumerable:!0,get:function(){return c.exponentialBackoffDelay}});var d=n(20815);Object.defineProperty(t,"delay",{enumerable:!0,get:function(){return d.delay}}),Object.defineProperty(t,"minimumDelay",{enumerable:!0,get:function(){return d.minimumDelay}});var u=n(30085);Object.defineProperty(t,"asyncTimeout",{enumerable:!0,get:function(){return u.asyncTimeout}})},51483:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=void 0,t.Queue=class{constructor(){this.q=[],this.awaiters=[],this.push=e=>{this.q.length>0?this.q.push(e):this.awaiters.length>0?this.awaiters.shift()(e):this.q.push(e)},this.get=()=>n(this,void 0,void 0,function*(){return this.q.length>0?this.q.shift():yield new Promise(e=>this.awaiters.push(e))}),this.getOptional=()=>this.q.length>0?this.q.shift():null}get isEmpty(){return 0===this.q.length}}},51931:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncLock=void 0,t.AsyncLock=class{constructor(){this.permits=1,this.promiseResolverQueue=[]}inLock(e){return n(this,void 0,void 0,function*(){try{return yield this.lock(),yield e()}finally{this.unlock()}})}lock(){return n(this,void 0,void 0,function*(){this.permits>0?this.permits=this.permits-1:yield new Promise(e=>this.promiseResolverQueue.push(e))})}unlock(){if(this.permits+=1,this.permits>1&&this.promiseResolverQueue.length>0)throw new Error("this.permits should never be > 0 when there is someone waiting.");if(1===this.permits&&this.promiseResolverQueue.length>0){this.permits-=1;const e=this.promiseResolverQueue.shift();e&&setTimeout(()=>{e(!0)},0)}}}},59157:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getInit=void 0;const r=n(1307);t.getInit=function(e,t,n){let i=(0,r.beginCell)().storeUint(0,32).storeUint(t,32).storeBuffer(e);return{code:n?r.Cell.fromBase64("te6cckEBAQEAcQAA3v8AIN0gggFMl7ohggEznLqxn3Gw7UTQ0x/THzHXC//jBOCk8mCDCNcYINMf0x/TH/gjE7vyY+1E0NMf0x/T/9FRMrryoVFEuvKiBPkBVBBV+RDyo/gAkyDXSpbTB9QC+wDo0QGkyMsfyx/L/8ntVBC9ba0="):r.Cell.fromBase64("te6ccgECFAEAAtQAART/APSkE/S88sgLAQIBIAIDAgFIBAUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8QERITAubQAdDTAyFxsJJfBOAi10nBIJJfBOAC0x8hghBwbHVnvSKCEGRzdHK9sJJfBeAD+kAwIPpEAcjKB8v/ydDtRNCBAUDXIfQEMFyBAQj0Cm+hMbOSXwfgBdM/yCWCEHBsdWe6kjgw4w0DghBkc3RyupJfBuMNBgcCASAICQB4AfoA9AQw+CdvIjBQCqEhvvLgUIIQcGx1Z4MesXCAGFAEywUmzxZY+gIZ9ADLaRfLH1Jgyz8gyYBA+wAGAIpQBIEBCPRZMO1E0IEBQNcgyAHPFvQAye1UAXKwjiOCEGRzdHKDHrFwgBhQBcsFUAPPFiP6AhPLassfyz/JgED7AJJfA+ICASAKCwBZvSQrb2omhAgKBrkPoCGEcNQICEekk30pkQzmkD6f+YN4EoAbeBAUiYcVnzGEAgFYDA0AEbjJftRNDXCx+AA9sp37UTQgQFA1yH0BDACyMoHy//J0AGBAQj0Cm+hMYAIBIA4PABmtznaiaEAga5Drhf/AABmvHfaiaEAQa5DrhY/AAG7SB/oA1NQi+QAFyMoHFcv/ydB3dIAYyMsFywIizxZQBfoCFMtrEszMyXP7AMhAFIEBCPRR8qcCAHCBAQjXGPoA0z/IVCBHgQEI9FHyp4IQbm90ZXB0gBjIywXLAlAGzxZQBPoCFMtqEssfyz/Jc/sAAgBsgQEI1xj6ANM/MFIkgQEI9Fnyp4IQZHN0cnB0gBjIywXLAlAFzxZQA/oCE8tqyx8Syz/Jc/sAAAr0AMntVA=="),data:n?i.endCell():i.storeBit(0).endCell()}}},69820:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncValue=void 0;const i=n(36612);t.SyncValue=class{constructor(e,t,n){this._value=e,this._updater=t,this._sync=new i.InvalidateSync(()=>r(this,void 0,void 0,function*(){yield this._updater(this._value)}),n)}get value(){return this._value}set value(e){Object.is(e,this._value)||(this._value=e,this._sync.invalidate())}}},74559:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAsyncIterator=void 0,t.createAsyncIterator=function(e){let t=[],n=[],r=()=>(t=[],n=[],e(),Promise.resolve({value:void 0,done:!0}));return{[Symbol.asyncIterator]:()=>({next:()=>new Promise(e=>{if(t.length>0){let n=t.shift();e(null===n?{value:void 0,done:!0}:{value:n,done:!1})}else n.push(e)}),return:r,throw:e=>Promise.reject(e)}),push(e){n.length>0?n.shift()({value:e,done:!1}):t.push(e)},complete(){n.length>0?n.shift()({value:null,done:!0}):t.push(null)}}}},78261:function(e,t){var n,r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.BoundedConcurrencyPool=t.UnboundedConcurrencyPool=void 0,t.UnboundedConcurrencyPool={run:e=>e()},t.BoundedConcurrencyPool=class{constructor(e){this.pending=[],n.set(this,0),this.concurrencyFactor="number"==typeof e?()=>e:e}run(e){var t,s;return r(this,void 0,void 0,function*(){i(this,n,"f")>=this.concurrencyFactor()&&(yield new Promise(e=>this.pending.push(e))),o(this,n,(t=i(this,n,"f"),++t),"f");try{return yield e()}finally{if(o(this,n,(s=i(this,n,"f"),--s),"f"),this.pending.length>0){let e=this.pending[0];this.pending.shift(),e()}}})}get inFlight(){return i(this,n,"f")}get inQueue(){return this.pending.length}},n=new WeakMap},80715:(e,t,n)=>{var r=n(48287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.TonTransport=t.parseMessage=t.KNOWN_EXTRA_CURRENCIES=t.KNOWN_JETTONS=void 0;const i=n(1307),o=n(75269),s=n(38106),a=n(32853),l=n(59157);t.KNOWN_JETTONS=[{symbol:"USDT",masterAddress:i.Address.parse("EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs")},{symbol:"NOT",masterAddress:i.Address.parse("EQAvlWFDxGF2lXm67y4yzC17wYKD9A0guwPkMs1gOsM__NOT")},{symbol:"tsTON",masterAddress:i.Address.parse("EQC98_qAmNEptUtPc7W6xdHh_ZHrBUFpw5Ft_IzNU20QAJav")},{symbol:"wsTON",masterAddress:i.Address.parse("EQB0SoxuGDx5qjVt0P_bPICFeWdFLBmVopHhjgfs0q-wsTON")},{symbol:"hTON",masterAddress:i.Address.parse("EQDPdq8xjAhytYqfGSX8KcFWIReCufsB9Wdg0pLlYSO_h76w")},{symbol:"stTON",masterAddress:i.Address.parse("EQDNhy-nxYFgUqzfUzImBEP67JqsyMIcyk2S5_RwNNEYku0k")},{symbol:"STAKED",masterAddress:i.Address.parse("EQCqC6EhRJ_tpWngKxL6dV0k6DSnRUrs9GSVkLbfdCqsj6TE")},{symbol:"CATI",masterAddress:i.Address.parse("EQD-cvR0Nz6XAyRBvbhz-abTrRC6sI5tvHvvpeQraV9UAAD7")},{symbol:"DOGS",masterAddress:i.Address.parse("EQCvxJy4eG8hyHBFsZ7eePxrRsUQSFE_jpptRAYBmcG_DOGS")},{symbol:"X",masterAddress:i.Address.parse("EQB4zZusHsbU2vVTPqjhlokIOoiZhEdCMT703CWEzhTOo__X")},{symbol:"tgBTC",masterAddress:i.Address.parse("EQBmjxpYsJ8yHEraYfTpLdejCekHMoKS2fOErP4lLHCf4SlU")}],t.KNOWN_EXTRA_CURRENCIES=[{id:1,symbol:"tgBTC",decimals:8}];const c=r.from([232,212,64,80,135,61,186,134,90,167,193,112,171,76,206,100,217,8,57,163,77,207,214,207,113,209,78,2,5,68,59,27]);function d(e){return 0n===e?null:e}function u(e,t){const n=Math.ceil(e.length/t),r=[];for(let i=0;i<n;i++)r.push(e.subarray(i*t,(i+1)*t));return r}function f(e){const t=e?.bounceable??!0,n=e?.testOnly??!1,r=e?.chain??0,i=e?.subwalletId??698983191,o=e?.walletVersion??"v4";let s,a=0;return n&&(a|=1),-1===r&&(a|=2),698983191===i&&"v4"===o||(a|=4,s={subwalletId:i,isV3R2:"v3r2"===o}),{bounceable:t,testOnly:n,chain:r,flags:a,specifiers:s}}function w(e){if(e.length<6)throw Error("Path is too short");if(44!==e[0])throw Error("First element of a path must be 44");if(607!==e[1])throw Error("Second element of a path must be 607");for(let t of e)if(t>=2147483648)throw Error("All path elements must be under 0x80000000")}function h(e){const t=r.alloc(1+4*e.length);return t[0]=e.length,e.forEach((e,n)=>{t.writeUInt32BE(e,1+4*n)}),t}t.parseMessage=function(e,t){const n={disallowUnsafe:!1,disallowModification:!1,encodeJettonBurnEthAddressAsHex:!0,...t};if(e.hash().equals((new i.Cell).hash()))return;let r=e.beginParse();try{const e=r.loadUint(32);switch(e){case 0:{const e=r.loadStringTail();if(r.endParse(),e.length>120)throw new Error("Comment must be at most 120 ASCII characters long");for(const t of e)if(t.charCodeAt(0)<32||t.charCodeAt(0)>=127)throw new Error("Comment must only contain printable ASCII characters");return{type:"comment",text:e}}case 260734629:{const e=d(r.loadUintBig(64)),t=r.loadCoins(),o=r.loadAddress(),s=r.loadAddress(),a=r.loadMaybeRef(),l=r.loadCoins();let c=null;if(r.loadBit())c=r.loadRef();else{const e=r.asCell();if(r=(new i.Cell).beginParse(),!e.hash().equals((new i.Cell).hash())){if(n.disallowModification)throw new Error("Jetton transfer message would be modified");c=e}}return r.endParse(),{type:"jetton-transfer",queryId:e,amount:t,destination:o,responseDestination:s,customPayload:a,forwardAmount:l,forwardPayload:c,knownJetton:null}}case 1607220500:{const e=d(r.loadUintBig(64)),t=r.loadAddress(),o=r.loadAddress(),s=r.loadMaybeRef(),a=r.loadCoins();let l=null;if(r.loadBit())l=r.loadRef();else{const e=r.asCell();if(r=(new i.Cell).beginParse(),!e.hash().equals((new i.Cell).hash())){if(n.disallowModification)throw new Error("Jetton transfer message would be modified");l=e}}return r.endParse(),{type:"nft-transfer",queryId:e,newOwner:t,responseDestination:o,customPayload:s,forwardAmount:a,forwardPayload:l}}case 1499400124:{const e=d(r.loadUintBig(64)),t=r.loadCoins(),i=r.loadAddress();let o=r.loadMaybeRef();if(r.endParse(),n.encodeJettonBurnEthAddressAsHex&&null!==o&&160===o.bits.length&&0===o.refs.length){const e=o.beginParse();o=e.loadBuffer(20),e.endParse()}return{type:"jetton-burn",queryId:e,amount:t,responseDestination:i,customPayload:o}}case 1918412443:{const e=d(r.loadUintBig(64)),t=r.loadAddress();return r.endParse(),{type:"add-whitelist",queryId:e,address:t}}case 4096:{const e=d(r.loadUintBig(64)),t=r.loadCoins();return r.endParse(),{type:"single-nominator-withdraw",queryId:e,amount:t}}case 4097:{const e=d(r.loadUintBig(64)),t=r.loadAddress();return r.endParse(),{type:"single-nominator-change-validator",queryId:e,address:t}}case 1205158801:{const e=d(r.loadUintBig(64));let t=null;return r.remainingBits>0&&(t=r.loadUintBig(64)),r.endParse(),{type:"tonstakers-deposit",queryId:e,appId:t}}case 1778069612:{const e=d(r.loadUintBig(64)),t=r.loadAddress(),n=r.loadUint(48),i=r.loadBit(),o=r.loadBit();return r.endParse(),{type:"vote-for-proposal",queryId:e,votingAddress:t,expirationDate:n,vote:i,needConfirmation:o}}case 1320284409:{const e=d(r.loadUintBig(64)),t=r.loadBuffer(32);if(t.equals(c)){if(r.remainingRefs>0){const t=r.loadRef().beginParse();if(r.remainingBits>0&&!n.disallowModification&&!r.loadBit())throw new Error("Incorrect change DNS record message");if(r.endParse(),40915!==t.loadUint(16))throw new Error("Wrong DNS record type");const i=t.loadAddress(),o=t.loadUint(8);if(o>1)throw new Error("DNS wallet record must have flags 0 or 1");let s=(1&o)>0?{isWallet:!1}:null;if(null!==s)for(;t.loadBit();){if(8567!==t.loadUint(16))throw new Error("Unknown DNS wallet record capability");if(s.isWallet&&n.disallowModification)throw new Error("DNS change record message would be modified");s.isWallet=!0}return{type:"change-dns-record",queryId:e,record:{type:"wallet",value:{address:i,capabilities:s}}}}if(r.remainingBits>0&&!n.disallowModification&&r.loadBit())throw new Error("Incorrect change DNS record message");return r.endParse(),{type:"change-dns-record",queryId:e,record:{type:"wallet",value:null}}}if(r.remainingRefs>0){const i=r.loadRef();if(r.remainingBits>0&&!n.disallowModification&&!r.loadBit())throw new Error("Incorrect change DNS record message");return r.endParse(),{type:"change-dns-record",queryId:e,record:{type:"unknown",key:t,value:i}}}if(r.remainingBits>0&&!n.disallowModification&&r.loadBit())throw new Error("Incorrect change DNS record message");return r.endParse(),{type:"change-dns-record",queryId:e,record:{type:"unknown",key:t,value:null}}}case 8:{const e=d(r.loadUintBig(64)),t=r.loadBuffer(32);return r.endParse(),{type:"token-bridge-pay-swap",queryId:e,swapId:t}}case 2077040623:{const e=r.loadUintBig(64);if(e<=0n)throw new Error("Incorrect query id: must be greater than 0");const t=r.loadCoins();return r.endParse(),{type:"tonwhales-pool-deposit",queryId:e,gasLimit:t}}case 3665837821:{const e=r.loadUintBig(64);if(e<=0n)throw new Error("Incorrect query id: must be greater than 0");const t=r.loadCoins(),n=r.loadCoins();return r.endParse(),{type:"tonwhales-pool-withdraw",queryId:e,gasLimit:t,amount:n}}case 2809346765:{const e=d(r.loadUintBig(64)),t=r.loadUint(8),n=r.loadRef().beginParse();r.endParse();const o=(0,i.loadMessageRelaxed)(n);if("internal"!==o.info.type)throw new Error("Message is not internal");const s=o.body.beginParse();if(0!==s.loadUint(32))throw new Error("Message body is not a comment");const a=s.loadStringTail();if(a.length>120)throw new Error("Comment must be at most 120 ASCII characters long");return s.endParse(),{type:"vesting-send-msg-comment",queryId:e,sendMode:t,value:o.info.value.coins,destination:o.info.dest,text:a}}}throw new Error("Unknown op: "+e)}catch(e){if(n.disallowUnsafe)throw e}return{type:"unsafe",message:e}},t.TonTransport=class{transport;#e=new s.AsyncLock;constructor(e){this.transport=e}async#t(){return this.#e.inLock(async()=>{let e=await this.transport.send(176,1,0,0,void 0,[36864]),t=e.slice(0,e.length-2);if(1!==t[0])throw Error("Invalid response");let n=t[1],r=t.slice(2,2+n).toString(),i=t[2+n];return{name:r,version:t.slice(3+n,3+n+i).toString()}})}async isAppOpen(){return"TON"===(await this.#t()).name}async getVersion(){let e=await this.#n(3,0,0,r.alloc(0));const[t,n,i]=e;return`${t}.${n}.${i}`}async getAddress(e,t){w(e);const{bounceable:n,testOnly:r,chain:o,specifiers:s}=f(t);let a=await this.#n(5,0,0,h(e.map(e=>e+2147483648)));if(32!==a.length)throw Error("Invalid response");const c=(0,l.getInit)(a,s?.subwalletId??698983191,s?.isV3R2??!1);return{address:(0,i.contractAddress)(o,c).toString({bounceable:n,testOnly:r}),publicKey:a}}async validateAddress(e,t){w(e);const{bounceable:n,testOnly:o,chain:s,flags:c,specifiers:d}=f(t);let u=h(e.map(e=>e+2147483648));void 0!==d&&(u=r.concat([u,(0,a.writeUint8)(d.isV3R2?1:0),(0,a.writeUint32)(d.subwalletId)]));let y=await this.#n(5,1,c,u);if(32!==y.length)throw Error("Invalid response");const p=(0,l.getInit)(y,d?.subwalletId??698983191,d?.isV3R2??!1);return{address:(0,i.contractAddress)(s,p).toString({bounceable:n,testOnly:o}),publicKey:y}}async getAddressProof(e,t,n){w(e);let i=(await this.getAddress(e)).publicKey;const{flags:s,specifiers:l}=f(n);let c=r.alloc(0);void 0!==l&&(c=r.concat([(0,a.writeUint8)(l.isV3R2?1:0),(0,a.writeUint32)(l.subwalletId)]));const d=r.from(t.domain,"utf-8"),u=r.concat([h(e.map(e=>e+2147483648)),c,(0,a.writeUint8)(d.length),d,(0,a.writeUint64)(BigInt(t.timestamp)),t.payload]);let y=await this.#n(8,1,s,u),p=y.slice(1,65),g=y.slice(66,98);if(!(0,o.signVerify)(g,p,i))throw Error("Received signature is invalid");return{signature:p,hash:g}}async signData(e,t,n){w(e);const s=(await this.getAddress(e)).publicKey,l=n?.timestamp??Math.floor(Date.now()/1e3);let c,d,f;switch(t.type){case"plaintext":c=1967913243,d=r.from(t.text,"ascii"),f=(0,i.beginCell)().storeStringTail(t.text).endCell();break;case"app-data":{if(void 0===t.address&&void 0===t.domain)throw new Error("At least one of `address` and `domain` must be set when using 'app-data' request");c=1421182261;let e=(0,i.beginCell)(),n=[];if(void 0!==t.address?(e.storeBit(1),e.storeAddress(t.address),n.push((0,a.writeUint8)(1),(0,a.writeAddress)(t.address))):(e.storeBit(0),n.push((0,a.writeUint8)(0))),void 0!==t.domain){e.storeBit(1);let o=(0,i.beginCell)();t.domain.split(".").reverse().forEach(e=>{o.storeBuffer(r.from(e,"ascii")),o.storeUint(0,8)}),e.storeRef(o);const s=r.from(t.domain,"ascii");n.push((0,a.writeUint8)(1),(0,a.writeUint8)(s.length),s)}else e.storeBit(0),n.push((0,a.writeUint8)(0));e.storeRef(t.data),n.push((0,a.writeCellRef)(t.data)),void 0!==t.ext?(e.storeBit(1),e.storeRef(t.ext),n.push((0,a.writeUint8)(1),(0,a.writeCellRef)(t.ext))):(e.storeBit(0),n.push((0,a.writeUint8)(0))),d=r.concat(n),f=e.endCell();break}default:throw new Error(`Sign data request type '${t.type}' not supported`)}const y=r.concat([(0,a.writeUint32)(c),(0,a.writeUint64)(BigInt(l))]),p=r.concat([y,d]);await this.#n(9,0,3,h(e.map(e=>e+2147483648)));const g=u(p,255);for(let e=0;e<g.length-1;e++)await this.#n(9,0,2,g[e]);const m=await this.#n(9,0,0,g[g.length-1]);let U=m.subarray(1,65),v=m.subarray(66,98);if(!v.equals(f.hash()))throw Error("Hash mismatch. Expected: "+f.hash().toString("hex")+", got: "+v.toString("hex"));if(!(0,o.signVerify)(r.concat([y,v]),U,s))throw Error("Received signature is invalid");return{signature:U,cell:f,timestamp:l}}signTransaction=async(e,n)=>{if(w(e),void 0!==n.extraCurrency&&n.extraCurrency.index>=t.KNOWN_EXTRA_CURRENCIES.length)throw Error("Invalid extra currency index");let s=(await this.getAddress(e)).publicKey;const l=n.walletSpecifiers?.includeWalletOp??!0,c=n.walletSpecifiers?.subwalletId??698983191,d=void 0!==n.walletSpecifiers||void 0!==n.extraCurrency;let f=r.concat([(0,a.writeUint8)(d?1:0)]);if(d){let e=0;l&&(e|=1),void 0!==n.extraCurrency&&(e|=2),f=r.concat([f,(0,a.writeUint32)(c),(0,a.writeUint8)(e)])}let y=r.alloc(0);void 0!==n.extraCurrency&&(y=r.concat([(0,a.writeUint8)(n.extraCurrency.index),(0,a.writeVarUInt)(n.extraCurrency.amount)])),f=r.concat([f,(0,a.writeUint32)(n.seqno),(0,a.writeUint32)(n.timeout),(0,a.writeVarUInt)(n.amount),y,(0,a.writeAddress)(n.to),(0,a.writeUint8)(n.bounce?1:0),(0,a.writeUint8)(n.sendMode)]);let p=null;n.stateInit?(p=(0,i.beginCell)().store((0,i.storeStateInit)(n.stateInit)).endCell(),f=r.concat([f,(0,a.writeUint8)(1),(0,a.writeUint16)(p.depth()),p.hash()])):f=r.concat([f,(0,a.writeUint8)(0)]);const{payload:g,hints:m}=function(e){let t=null,n=r.concat([(0,a.writeUint8)(0)]);if(void 0===e)return{payload:t,hints:n};switch(e.type){case"unsafe":t=e.message;break;case"comment":n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(0),(0,a.writeUint16)(r.from(e.text).length),r.from(e.text)]),t=(0,i.beginCell)().storeUint(0,32).storeBuffer(r.from(e.text)).endCell();break;case"jetton-transfer":case"nft-transfer":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)("jetton-transfer"===e.type?1:2)]);let o=(0,i.beginCell)().storeUint("jetton-transfer"===e.type?260734629:1607220500,32),s=r.alloc(0),l=0;null!==e.queryId&&(l|=1),"jetton-transfer"===e.type&&null!==e.knownJetton&&(l|=2),s=r.concat([s,(0,a.writeUint8)(l)]),null!==e.queryId?(s=r.concat([s,(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):o=o.storeUint(0,64),"jetton-transfer"===e.type?(null!==e.knownJetton&&(s=r.concat([s,(0,a.writeUint16)(e.knownJetton.jettonId),(0,a.writeUint8)(e.knownJetton.workchain)])),s=r.concat([s,(0,a.writeVarUInt)(e.amount)]),o=o.storeCoins(e.amount),s=r.concat([s,(0,a.writeAddress)(e.destination)]),o=o.storeAddress(e.destination)):(s=r.concat([s,(0,a.writeAddress)(e.newOwner)]),o=o.storeAddress(e.newOwner)),s=r.concat([s,(0,a.writeAddress)(e.responseDestination)]),o=o.storeAddress(e.responseDestination),null!==e.customPayload?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeCellRef)(e.customPayload)]),o=o.storeMaybeRef(e.customPayload)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeMaybeRef(e.customPayload)),s=r.concat([s,(0,a.writeVarUInt)(e.forwardAmount)]),o=o.storeCoins(e.forwardAmount),null!==e.forwardPayload?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeCellRef)(e.forwardPayload)]),o=o.storeMaybeRef(e.forwardPayload)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeMaybeRef(e.forwardPayload)),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"jetton-burn":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(3)]);let o=(0,i.beginCell)().storeUint(1499400124,32),s=r.alloc(0);null!==e.queryId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeUint(0,64)),s=r.concat([s,(0,a.writeVarUInt)(e.amount)]),o=o.storeCoins(e.amount),s=r.concat([s,(0,a.writeAddress)(e.responseDestination)]),o=o.storeAddress(e.responseDestination),null===e.customPayload?(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeMaybeRef(e.customPayload)):e.customPayload instanceof i.Cell?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeCellRef)(e.customPayload)]),o=o.storeMaybeRef(e.customPayload)):(s=r.concat([s,(0,a.writeUint8)(2),(0,a.writeCellInline)(e.customPayload)]),o=o.storeMaybeRef((0,i.beginCell)().storeBuffer(e.customPayload).endCell())),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"add-whitelist":case"single-nominator-change-validator":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)("add-whitelist"===e.type?4:6)]);let o=(0,i.beginCell)().storeUint("add-whitelist"===e.type?1918412443:4097,32),s=r.alloc(0);null!==e.queryId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeUint(0,64)),s=r.concat([s,(0,a.writeAddress)(e.address)]),o=o.storeAddress(e.address),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"single-nominator-withdraw":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(5)]);let o=(0,i.beginCell)().storeUint(4096,32),s=r.alloc(0);null!==e.queryId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeUint(0,64)),s=r.concat([s,(0,a.writeVarUInt)(e.amount)]),o=o.storeCoins(e.amount),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"tonstakers-deposit":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(7)]);let o=(0,i.beginCell)().storeUint(1205158801,32),s=r.alloc(0);null!==e.queryId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeUint(0,64)),null!==e.appId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.appId)]),o=o.storeUint(e.appId,64)):s=r.concat([s,(0,a.writeUint8)(0)]),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"vote-for-proposal":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(8)]);let o=(0,i.beginCell)().storeUint(1778069612,32),s=r.alloc(0);null!==e.queryId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeUint(0,64)),s=r.concat([s,(0,a.writeAddress)(e.votingAddress)]),o=o.storeAddress(e.votingAddress),s=r.concat([s,(0,a.writeUint48)(e.expirationDate)]),o=o.storeUint(e.expirationDate,48),s=r.concat([s,(0,a.writeUint8)(e.vote?1:0),(0,a.writeUint8)(e.needConfirmation?1:0)]),o=o.storeBit(e.vote).storeBit(e.needConfirmation),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"change-dns-record":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(9)]);let s=(0,i.beginCell)().storeUint(1320284409,32),l=r.alloc(0);if(null!==e.queryId?(l=r.concat([l,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),s=s.storeUint(e.queryId,64)):(l=r.concat([l,(0,a.writeUint8)(0)]),s=s.storeUint(0,64)),"unknown"===e.record.type&&32!==e.record.key.length)throw new Error("DNS record key length must be 32 bytes long");if(s=s.storeBuffer("wallet"===e.record.type?(0,o.sha256_sync)("wallet"):e.record.key),l=r.concat([l,(0,a.writeUint8)(null===e.record.value?0:1),(0,a.writeUint8)("wallet"===e.record.type?0:1)]),"wallet"===e.record.type){if(null!==e.record.value){l=r.concat([l,(0,a.writeAddress)(e.record.value.address),(0,a.writeUint8)(null===e.record.value.capabilities?0:1)]);let t=(0,i.beginCell)().storeUint(40915,16).storeAddress(e.record.value.address).storeUint(null===e.record.value.capabilities?0:1,8);null!==e.record.value.capabilities&&(l=r.concat([l,(0,a.writeUint8)(e.record.value.capabilities.isWallet?1:0)]),e.record.value.capabilities.isWallet&&(t=t.storeBit(!0).storeUint(8567,16)),t=t.storeBit(!1)),s=s.storeRef(t)}}else l=r.concat([l,e.record.key]),null!==e.record.value&&(l=r.concat([l,(0,a.writeCellRef)(e.record.value)]),s=s.storeRef(e.record.value));t=s.endCell(),n=r.concat([n,(0,a.writeUint16)(l.length),l]);break}case"token-bridge-pay-swap":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(10)]);let o=(0,i.beginCell)().storeUint(8,32),s=r.alloc(0);if(null!==e.queryId?(s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)]),o=o.storeUint(e.queryId,64)):(s=r.concat([s,(0,a.writeUint8)(0)]),o=o.storeUint(0,64)),32!==e.swapId.length)throw new Error("Token bridge swap ID must be 32 bytes long");s=r.concat([s,e.swapId]),o=o.storeBuffer(e.swapId),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"tonwhales-pool-deposit":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(11)]);const o=(0,i.beginCell)().storeUint(2077040623,32).storeUint(e.queryId,64).storeCoins(e.gasLimit).endCell(),s=r.concat([(0,a.writeUint64)(e.queryId),(0,a.writeVarUInt)(e.gasLimit)]);t=o,n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"tonwhales-pool-withdraw":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(12)]);const o=(0,i.beginCell)().storeUint(3665837821,32).storeUint(e.queryId,64).storeCoins(e.gasLimit).storeCoins(e.amount).endCell(),s=r.concat([(0,a.writeUint64)(e.queryId),(0,a.writeVarUInt)(e.gasLimit),(0,a.writeVarUInt)(e.amount)]);t=o,n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}case"vesting-send-msg-comment":{n=r.concat([(0,a.writeUint8)(1),(0,a.writeUint32)(13)]);let o=(0,i.beginCell)().storeUint(2809346765,32),s=r.alloc(0);null!==e.queryId?(o=o.storeUint(e.queryId,64),s=r.concat([s,(0,a.writeUint8)(1),(0,a.writeUint64)(e.queryId)])):(o=o.storeUint(0,64),s=r.concat([s,(0,a.writeUint8)(0)])),o=o.storeUint(e.sendMode,8),s=r.concat([s,(0,a.writeUint8)(e.sendMode)]);const l=(0,i.internal)({to:e.destination,value:e.value,body:(0,i.beginCell)().storeUint(0,32).storeStringTail(e.text).endCell()}),c=(0,i.beginCell)();if((0,i.storeMessageRelaxed)(l)(c),o=o.storeRef(c.endCell()),s=r.concat([s,(0,a.writeAddress)(e.destination)]),s=r.concat([s,(0,a.writeVarUInt)(e.value)]),e.text.length>120)throw new Error("Comment must be at most 120 ASCII characters long");s=r.concat([s,(0,a.writeUint8)(r.from(e.text).length),r.from(e.text)]),t=o.endCell(),n=r.concat([n,(0,a.writeUint16)(s.length),s]);break}default:throw new Error("Unknown payload type: "+e.type)}return{payload:t,hints:n}}(n.payload);f=g?r.concat([f,(0,a.writeUint8)(1),(0,a.writeUint16)(g.depth()),g.hash(),m]):r.concat([f,(0,a.writeUint8)(0),(0,a.writeUint8)(0)]),await this.#n(6,0,3,h(e.map(e=>e+2147483648)));const U=u(f,255);for(let e=0;e<U.length-1;e++)await this.#n(6,0,2,U[e]);let v=await this.#n(6,0,0,U[U.length-1]),b=(0,i.beginCell)().storeBit(0).storeBit(!0).storeBit(n.bounce).storeBit(!1).storeAddress(null).storeAddress(n.to).storeCoins(n.amount);b=void 0!==n.extraCurrency?b.storeBit(!0).storeRef((0,i.beginCell)().storeUint(2,2).storeUint(32,6).storeUint(t.KNOWN_EXTRA_CURRENCIES[n.extraCurrency.index].id,32).storeVarUint(n.extraCurrency.amount,5)):b.storeBit(!1),b=b.storeCoins(0).storeCoins(0).storeUint(0,64).storeUint(0,32),b=p?b.storeBit(!0).storeBit(!0).storeRef(p):b.storeBit(!1),b=g?b.storeBit(!0).storeRef(g):b.storeBit(!1);let A=(0,i.beginCell)().storeUint(c,32).storeUint(n.timeout,32).storeUint(n.seqno,32);l&&(A=A.storeUint(0,8));let C=A.storeUint(n.sendMode,8).storeRef(b.endCell()).endCell(),I=v.slice(1,65),B=v.slice(66,98);if(!B.equals(C.hash()))throw Error("Hash mismatch. Expected: "+C.hash().toString("hex")+", got: "+B.toString("hex"));if(!(0,o.signVerify)(B,I,s))throw Error("Received signature is invalid");return(0,i.beginCell)().storeBuffer(I).storeSlice(C.beginParse()).endCell()};async getSettings(){let e=await this.#n(10,0,0,r.alloc(0));return{blindSigningEnabled:(1&e[0])>0,expertMode:(2&e[0])>0}}#n=async(e,t,n,r)=>this.#e.inLock(async()=>{let i=await this.transport.send(224,e,t,n,r);return i.slice(0,i.length-2)})}}}]);
//# sourceMappingURL=557.73c8c81c54275740bbe9.js.map